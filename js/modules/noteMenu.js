define([WEBROOT_URL+"js/modules/noteboard.js",WEBROOT_URL+"js/core/sandbox.js"],function(a,b){var c=void 0,d=function(){c=this,c.sandbox=new b(c),c.itemsDisabled=[],$.contextMenu({selector:".untMenu",items:f(),build:function(b){c.note=b;var d=c.note.data("model");a.permissions===!0||a.permissions.canEdit?(c.itemsDisabled.lock=d.data.locked,c.itemsDisabled.unlock=!d.data.locked):(c.itemsDisabled.lock=!0,c.itemsDisabled.unlock=!0)},callback:function(a){i(a)}}),$.contextMenu({selector:".untMenuImage",items:f("image"),build:function(a){c.note=a;var b=c.note.data("model");c.itemsDisabled.lock=b.data.locked,c.itemsDisabled.unlock=!b.data.locked},callback:function(a){i(a)}}),$.contextMenu({selector:".untMenuCircle",items:f("circle"),build:function(a){c.note=a;var b=c.note.data("model");c.itemsDisabled.lock=b.data.locked,c.itemsDisabled.unlock=!b.data.locked},callback:function(a){i(a)}}),$.contextMenu({selector:".untMenuVideo",items:f("video"),build:function(a){c.note=a;var b=c.note.data("model");c.itemsDisabled.lock=b.data.locked,c.itemsDisabled.unlock=!b.data.locked},callback:function(a){i(a)}}),$.contextMenu({selector:".untMenuFrame",items:f("frame"),build:function(a){c.note=a;var b=c.note.data("model");c.itemsDisabled.lock=b.data.locked,c.itemsDisabled.unlock=!b.data.locked},callback:function(a){i(a)}}),$.contextMenu({selector:".untMenuComment",items:f("comment"),build:function(a){c.note=a;var b=c.note.data("model");c.itemsDisabled.lock=b.data.locked,c.itemsDisabled.unlock=!b.data.locked},callback:function(a){i(a)}}),$.contextMenu({selector:"#noteboard",items:g(),build:function(a,b){c.note=a,c.event=b},callback:function(a){i(a)}})},e=function(a){return c.itemsDisabled[a]},f=function(a){var b={lock:{name:i18n.lockResource,icon:"lock",disabled:e},unlock:{name:i18n.unlockResource,icon:"unlocked",disabled:e},sep1:"----------",forward:{name:i18n.sendForward,icon:"copy",disabled:e},back:{name:i18n.sendBack,icon:"copy2",disabled:e},sep2:"----------",bg:{name:i18n.changeBG,icon:"droplet",items:{menuColor:{className:"menuColor",name:h}},disabled:e},size:{name:i18n.changeSize,icon:"text-height",items:{"fs-0.8em":{name:"x-small",className:"xsmall"},"fs-1em":{name:"small",className:"small"},"fs-1.2em":{name:"normal",className:"normal"},"fs-1.4em":{name:"large",className:"large"},"fs-1.8em":{name:"x-large",className:"xlarge"}},disabled:e},family:{name:i18n.changeFont,icon:"font",items:{"ff-paprika":{name:"Paprika",className:"paprika"},"ff-arial":{name:"Arial",className:"arial"},"ff-courier":{name:"Courier",className:"courier"},"ff-times":{name:"Times",className:"times"},"ff-agenda":{name:"Agenda",className:"agenda"}},disabled:e},color:{name:i18n.changeColor,icon:"paint-format",items:{"c-black":{name:i18n.black,className:"black"},"c-red":{name:i18n.red,className:"red"},"c-blue":{name:i18n.blue,className:"blue"},"c-green":{name:i18n.green,className:"green"},"c-gray":{name:i18n.gray,className:"gray"}},disabled:e},attach:{name:i18n.attachNote,icon:"attachment",disabled:e},downloadImage:{name:i18n.downloadImage,icon:"download3",disabled:e},previewImage:{name:i18n.previewImage,icon:"image",disabled:e},sep3:"----------",remove:{name:i18n.removeNote,icon:"remove",disabled:e}};switch(a){case"image":b.bg=void 0,b.size=void 0,b.family=void 0,b.color=void 0,b.attach=void 0,b.remove.name=i18n.removeImage;break;case"circle":b.size=void 0,b.family=void 0,b.color=void 0,b.attach=void 0,b.downloadImage=void 0,b.previewImage=void 0,b.remove.name=i18n.removeObject;break;case"video":b.bg=void 0,b.size=void 0,b.family=void 0,b.color=void 0,b.attach=void 0,b.downloadImage=void 0,b.previewImage=void 0,b.sep2=void 0,b.remove.name=i18n.removeVideo;break;case"frame":b.bg=void 0,b.size=void 0,b.family=void 0,b.color=void 0,b.attach=void 0,b.downloadImage=void 0,b.previewImage=void 0,b.sep1=void 0,b.remove.name=i18n.removeArea;break;case"comment":b.bg.name=i18n.changeBGComment,b.size=void 0,b.family=void 0,b.color=void 0,b.attach=void 0,b.downloadImage=void 0,b.previewImage=void 0,b.sep1=void 0,b.remove.name=i18n.removeComment;break;default:b.downloadImage=void 0,b.previewImage=void 0}return b},g=function(){return{note:{name:i18n.addNote,icon:"file"},image:{name:i18n.addImage,icon:"image"},video:{name:i18n.addVideo,icon:"play"},comment:{name:i18n.addComment,icon:"bubbles"},sep1:"----------",lockAll:{name:i18n.lockAllResources,icon:"lock",disabled:e},unlockAll:{name:i18n.unlockAllResources,icon:"unlocked",disabled:e}}},h=function(){var a=void 0,b=void 0,d=$("<div>",{id:"untMenu"}).on("mouseover",function(d){void 0==a&&(a=c.note.data("bg"),b=a),void 0!=$(d.target).attr("class")&&(c.note.removeClass(b),b=$(d.target).data("color"),c.note.addClass(b))}).on("mouseout",function(){c.note.removeClass(b),void 0!=a&&(c.note.addClass(a),a=void 0)}).on("click",function(){$(this).off("mouseout"),c.note.data("model").setBG({bg:b})}).html('<ul>	                    <li class="untPreviewNote yellow" data-color="yellow"></li>	                    <li class="untPreviewNote red" data-color="red"></li>	                    <li class="untPreviewNote orange" data-color="orange"></li>	                    <li class="untPreviewNote green" data-color="green"></li>	                    <li class="untPreviewNote blue" data-color="blue"></li>	                    <li class="untPreviewNote violet" data-color="violet"></li>	                    <li class="untPreviewNote pink" data-color="pink"></li>	                    <li class="untPreviewNote lgray" data-color="lgray"></li>	                    <li class="untPreviewNote gray" data-color="gray"></li>	                </ul>');return d},i=function(b){var d=b.split("-"),e=d[0],b=d[1]||d[0],f=c.note.data("model"),g={id:c.note.attr("data-id")};switch(e){case"ff":return void f.setFF({ff:b});case"fs":return void f.setFS({fs:b});case"c":return void f.setC({c:b});case"forward":return void f.incrementIndex({});case"back":return void f.decrementIndex({});case"remove":return void f.remove({});case"attach":return void f.attachZone();case"lock":return void f.setLocked(!0);case"unlock":return void f.setLocked(!1);case"lockAll":return void a.models.forEach(function(a){a.setLocked(!0)});case"unlockAll":return void a.models.forEach(function(a){a.setLocked(!1)});case"image":case"note":case"circle":case"video":case"comment":g.l=(c.event.pageX-a.target.offset().left)/a.scale,g.t=(c.event.pageY-a.target.offset().top)/a.scale}c.sandbox.emit("resource-"+e,g)};return{init:d}});